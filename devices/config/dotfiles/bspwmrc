#!/usr/bin/env sh

screenheight=$(xdpyinfo | awk -F'[ x]+' '/dimensions:/{print $4}')
screenwidth=$(xdpyinfo | awk -F'[ x]+' '/dimensions:/{print $3}')
windowwidth=$(echo "$screenwidth"/2.75 | bc)
windowheight=$(echo "$screenheight"/2.5 | bc)
windowx=$(echo "$screenwidth"/2-"$windowwidth"/2 | bc)
windowy=$(echo "$screenheight"/2-"$windowheight"/2 | bc)

#### AUTOSTART ####
# wal -R
nitrogen --restore &
alttab -w 1 -d 1 -sc 0 -i 199x64 -t 200x200 -s 3 -bg "#1C1E27" -fg "#cacacc" -frame "#E95678" -font "xft:Roboto:weight=bold:size=11" -theme "WhiteSur-dark" &
blueberry-tray &
clipmenud &
xsetroot -cursor_name left_ptr & # fix cursor size for 4k display
eww daemon &
echo "$(pulsemixer --get-volume | awk '{print $1}')" > /tmp/vol &
exec /etc/eww_vol_icon.sh mute &
for m in $(xrandr --query | grep " connected" | cut -d" " -f1); do
  MONITOR=$m polybar main &
done

#### BSPWM coloring ####
# source the colors.
# . "${HOME}/.cache/wal/colors.sh"
bspc config normal_border_color \#282e3a
bspc config active_border_color \#2C4E9C
# bspc config focused_border_color \#4dd0e1
bspc config focused_border_color \#E95678
bspc config urgent_border_color  \#dc322f
bspc config presel_feedback_color \#18348D

#### BSPWM configuration ####
bspc config border_width 4
bspc config window_gap   16
bspc config split_ratio         0.50
bspc config borderless_monocle  true
bspc config focus_follows_pointer true
# bspc config gapless_monocle     true
# bspc config focus_by_distance   true

bspc rule -a "mpv" state=floating sticky=on
bspc rule -a ".pick-colour-picker-wrapped" state=floating sticky=on
bspc rule -a "flameshot" state=floating sticky=on
bspc rule -a "Thunar" state=pseudo_tiled rectangle="$windowwidth"x"$windowheight"+"$windowx"+$windowy
bspc rule -a "Org.gnome.Nautilus" state=pseudo_tiled rectangle="$windowwidth"x"$windowheight"+"$windowx"+$windowy
bspc rule -a "Pavucontrol" state=pseudo_tiled
bspc rule -a "Gnome-calculator" state=floating
bspc rule -a "Gnome-font-viewer" state=floating
bspc rule -a "File-roller" state=floating
bspc rule -a "Image Lounge" state=floating
bspc rule -a "Nitrogen" state=pseudo_tiled
bspc rule -a "Cheese" state=pseudo_tiled
bspc rule -a "Blueberry.py" state=pseudo_tiled
bspc rule -a "Gnome-sound-recorder" state=pseudo_tiled
bspc rule -a "Thunderbird" state=pseudo_tiled

#### BSPWM workspaces ####
for m in $(xrandr --query | grep " connected" | cut -d" " -f1); do
  bspc monitor $m -d 1 2 3 4 5 6 7 8
done
