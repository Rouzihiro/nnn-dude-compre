

all_tags=$(((1 << 32) - 1))
kitty_scratch_tag=$((1 << 31))
file_manager_tag=$((1 << 30))
kitty_neorg_tag=$((1 << 29))
kitty_top_tag=$((1 << 28))
kitty_neomutt_tag=$((1 << 27))
kitty_newsboat_tag=$((1 << 26))
kitty_ncmpcpp_tag=$((1 << 25))

# Use the "logo" key as the primary modifier
mod="Mod4"
ctrl="Control"
alt="Mod1"

# Mod + Left Mouse Button to move views
riverctl map-pointer normal $mod BTN_LEFT move-view

# Mod + Right Mouse Button to resize views
riverctl map-pointer normal $mod BTN_RIGHT resize-view


### SYSTEM KEYBINDINGS

# Reload the configuration file
riverctl map normal $mod+$ctrl+$alt Escape spawn \
  "bash ~/.config/river/init"

# Open scratchpad terminal
riverctl map normal $mod i spawn \
  "river-focus-toggle kitty-scratch $HOME/.config/kitty/scripts/kitty-scratch.sh $kitty_scratch_tag"

# Lock screen
riverctl map normal $mod l spawn \
  "bash /etc/scripts/system/sway-lock.sh"

# Open power menu
riverctl map normal $mod Escape spawn \
  "rofi-powermenu"

# Open app launcher
riverctl map normal $mod space spawn \
  "rofi-launcher"

# Take fullscreen screenshoot
riverctl map normal $mod Print spawn \
  "bash /etc/scripts/system/takeshot.sh --now"

# Open calc
riverctl map normal $mod c spawn \
  "rofi-calc"

# TODO: Show keybindings

# Show clipboard
riverctl map normal $mod v spawn \
  "bash /etc/scripts/system/clipboard-manager.sh --menu"

# Clear clipboard
riverctl map normal $mod+Shift v spawn \
  "bash /etc/scripts/system/clipboard-manager.sh --clear"

# Show emojis
riverctl map normal $mod e spawn \
  "rofi-emoji"

# Show last notification
riverctl map normal $mod+$ctrl n spawn \
  "dunstctl history-pop"

# Hide recent notification
riverctl map normal $mod+$ctrl+Shift n spawn \
  "dunstctl close"

# Hide all notifications
riverctl map normal $mod+$ctrl+Shift Escape spawn \
  "dunstctl close-all"

# Toggle bar
riverctl map normal $mod b spawn \
  "bash /etc/scripts/waybar/waybar-toggle.sh"


### WM KEYBINDINGS

# Close focused view
riverctl map normal $mod+Shift w close

# Toggle float
riverctl map normal $mod s toggle-float

# Toggle fullscreen
riverctl map normal $mod f toggle-fullscreen

# Set the node flags (sticky)
riverctl map normal $mod+$ctrl y set-view-tags $all_tags
riverctl map normal $mod+$ctrl+Shift Y send-to-output -current-tags

# Focus direction
riverctl map normal $mod Left focus-view left
riverctl map normal $mod Down focus-view down
riverctl map normal $mod Up focus-view up
riverctl map normal $mod Right focus-view right
riverctl map normal $mod n focus-view next
riverctl map normal $mod p focus-view previous

# Swap direction
riverctl map normal $mod+Shift Left swap left
riverctl map normal $mod+Shift Down swap down
riverctl map normal $mod+Shift Up swap up
riverctl map normal $mod+Shift Right swap right
riverctl map normal $mod+Shift n swap next
riverctl map normal $mod+Shift p swap previous

# To focus the next/previous output
riverctl map normal $mod Period focus-output next
riverctl map normal $mod Comma focus-output previous

# To send the focused view to the next/previous output
riverctl map normal $mod+Shift Period send-to-output next
riverctl map normal $mod+Shift Comma send-to-output previous

# To bump the focused view to the top of the layout stack
riverctl map normal $mod Return zoom

riverctl declare-mode rivercarro
riverctl map normal $mod r enter-mode rivercarro
# To decrease/increase the main ratio of rivercarro(1)
riverctl map rivercarro None Left send-layout-cmd rivercarro "main-ratio -0.05"
riverctl map rivercarro None Right send-layout-cmd rivercarro "main-ratio +0.05"
# To increment/decrement the main count of rivercarro(1)
riverctl map rivercarro Shift Left send-layout-cmd rivercarro "main-count +1"
riverctl map rivercarro Shift Right send-layout-cmd rivercarro "main-count -1"
# Change layout orientation
riverctl map rivercarro $ctrl+Shift Up spawn "riverctl send-layout-cmd rivercarro \"main-location top\"; riverctl enter-mode normal"
riverctl map rivercarro $ctrl+Shift Right spawn "riverctl send-layout-cmd rivercarro \"main-location right\"; riverctl enter-mode normal"
riverctl map rivercarro $ctrl+Shift Down spawn "riverctl send-layout-cmd rivercarro \"main-location bottom\"; riverctl enter-mode normal"
riverctl map rivercarro $ctrl+Shift Left spawn "riverctl send-layout-cmd rivercarro \"main-location left\"; riverctl enter-mode normal"
riverctl map rivercarro $ctrl+Shift m spawn "riverctl send-layout-cmd rivercarro \"main-location monocle\"; riverctl enter-mode normal"
riverctl map rivercarro None Escape enter-mode normal

# Snap
riverctl map normal $mod+$alt+$ctrl Left snap left
riverctl map normal $mod+$alt+$ctrl Down snap down
riverctl map normal $mod+$alt+$ctrl Up snap up
riverctl map normal $mod+$alt+$ctrl Right snap right

# Move
riverctl map normal $mod+$alt Left move left 40
riverctl map normal $mod+$alt Down move down 40
riverctl map normal $mod+$alt Up move up 40
riverctl map normal $mod+$alt Right move right 40

# Resize
riverctl map normal $mod+$alt+Shift Left resize horizontal -40
riverctl map normal $mod+$alt+Shift Down resize vertical 40
riverctl map normal $mod+$alt+Shift Up resize vertical -40
riverctl map normal $mod+$alt+Shift Right resize horizontal 40


### WM TAGS/VIEWS

for i in $(seq 1 9)
do
    tags=$((1 << ($i - 1)))

    # Mod+[1-9] to focus tag [0-8]
    riverctl map normal $mod $i set-focused-tags $tags

    # Mod+Shift+[1-9] to tag focused view with tag [0-8]
    riverctl map normal $mod+Shift $i set-view-tags $tags

    # Mod+Ctrl+[1-9] to toggle focus of tag [0-8]
    riverctl map normal $mod+$ctrl $i toggle-focused-tags $tags

    # Mod+Shift+Ctrl+[1-9] to toggle tag [0-8] of focused view
    riverctl map normal $mod+Shift+$ctrl $i toggle-view-tags $tags
done

# Mod+0 to focus all tags
riverctl map normal $mod 0 set-focused-tags $all_tags


### WM SCRATCHPAD

# The scratchpad will live on an unused tag. Which tags are used depends on your
# config, but rivers default uses the first 9 tags.
scratch_tag=$((1 << 20 ))

# Toggle the scratchpad with Super+P
riverctl map normal $mod d toggle-focused-tags ${scratch_tag}

# Send windows to the scratchpad with Super+Shift+P
riverctl map normal $mod+Shift d set-view-tags ${scratch_tag}

# Set spawn tagmask to ensure new windows don't have the scratchpad tag unless
# explicitly set. It also takes in consideration my custom special tags
all_but_scratch_tag=$(( ((1 << 32) - 1) ^ $scratch_tag ^ $kitty_scratch_tag ^ file_manager_tag ^ kitty_neorg_tag ^ kitty_top_tag ^ kitty_neomutt_tag ^ kitty_newsboat_tag ^ kitty_ncmpcpp_tag))
riverctl spawn-tagmask ${all_but_scratch_tag}


### APPLICATION KEYBINDINGS (Super + Alt + Key)

# Open primary terminal
riverctl map normal $mod+$alt t spawn \
  "kitty"

# Open file manager
riverctl map normal $mod+$alt f spawn \
  "river-focus-toggle thunar thunar $file_manager_tag"

# Screencast/record region to mp4
riverctl map normal $mod+$alt r spawn \
  "bash /etc/scripts/system/recorder.sh --area"

# Open screenshoot utility
riverctl map normal $mod+$alt s spawn \
  "bash /etc/scripts/system/takeshot.sh --area"

# Open color picker
riverctl map normal $mod+$alt c spawn \
  "bash /etc/scripts/system/color-picker.sh"

# Open Browser
riverctl declare-mode browser
riverctl map normal $mod+$alt b enter-mode browser
riverctl map browser None f spawn "riverctl enter-mode normal; firefox"
riverctl map browser None b spawn "riverctl enter-mode normal; brave"
riverctl map browser None g spawn "riverctl enter-mode normal; google-chrome-stable"
riverctl map browser None Escape enter-mode normal

# TODO: Open magnifying glass

# Terminal TUI
riverctl declare-mode tui
riverctl map normal $mod+$alt u enter-mode tui
riverctl map tui None n spawn "river-focus-toggle kitty-neorg \"$HOME/.config/kitty/scripts/kitty-neorg.sh\" $kitty_neorg_tag; riverctl enter-mode normal"
riverctl map tui None m spawn "river-focus-toggle kitty-top \"$HOME/.config/kitty/scripts/kitty-top.sh\" $kitty_top_tag; riverctl enter-mode normal"
riverctl map tui None e spawn "river-focus-toggle kitty-neomutt \"$HOME/.config/kitty/scripts/kitty-neomutt.sh\" $kitty_neomutt_tag; riverctl enter-mode normal"
riverctl map tui None r spawn "river-focus-toggle kitty-newsboat \"$HOME/.config/kitty/scripts/kitty-newsboat.sh\" $kitty_newsboat_tag; riverctl enter-mode normal"
riverctl map tui None u spawn "river-focus-toggle kitty-ncmpcpp \"$HOME/.config/kitty/scripts/kitty-ncmpcpp.sh\" $kitty_ncmpcpp_tag; riverctl enter-mode normal"
riverctl map tui None Escape enter-mode normal


### MEDIA KEYBINDINGS

for mode in normal locked
do
  riverctl map $mode None XF86AudioRaiseVolume spawn \
    "wob-osd --volume +5%"

  riverctl map $mode None XF86AudioLowerVolume spawn \
    "wob-osd --volume -5%"

  riverctl map $mode None XF86AudioMute spawn \
    "wob-osd --volume-toggle"

  riverctl map $mode None XF86AudioNext spawn \
    "playerctl next"

  riverctl map $mode None XF86AudioPrev spawn \
    "playerctl previous"

  riverctl map $mode None XF86AudioStop spawn \
    "playerctl pause"

  riverctl map $mode None XF86AudioPlay spawn \
    "playerctl play-pause"

  riverctl map $mode None XF86MonBrightnessUp spawn \
    "wob-osd --backlight 5%+"

  riverctl map $mode None XF86MonBrightnessDown spawn \
    "wob-osd --backlight 5%-"

  riverctl map $mode None XF86KbdBrightnessUp spawn \
    "wob-osd --kbd-backlight 5%+"

  riverctl map $mode None XF86KbdBrightnessDown spawn \
    "wob-osd --kbd-backlight 5%-"
done

# vim: syntax=sh
